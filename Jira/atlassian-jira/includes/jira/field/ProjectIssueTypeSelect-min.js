define("jira/field/project-issue-type-select",["jira/lib/class"],(function(e){"use strict";return e.extend({init:function(e){var s,t=this;this.$project=e.project;this.issueTypeSelect=e.issueTypeSelect;this.$projectIssueTypesSchemes=e.projectIssueTypesSchemes;this.$issueTypeSchemeIssueDefaults=e.issueTypeSchemeIssueDefaults;this.projectIssueTypeSchemes=JSON.parse(this.$projectIssueTypesSchemes.html());this.issueTypesSchemeDefaults=JSON.parse(this.$issueTypeSchemeIssueDefaults.html()||"[]");if(t.$project.length>0){s=t.$project.val();t.setIssueTypeScheme(t.getIssueTypeSchemeForProject(s));this.$project.change((function(){var e=t.$project.val();t._handleProjectChanged(t.getIssueTypeSchemeForProject(e))}))}},_handleProjectChanged:function(e){this.issueTypeSelect.model.setFilterGroup(e);var s=this.getDefaultIssueTypeForScheme(e),t=this.issueTypeSelect.model.getDescriptor(s),i=this.issueTypeSelect.model.getValue();this.issueTypeSelect.model.$element.data("move-context")?this._handleProjectChangedWhenIssueMoved(t,i):this._handleProjectChangedWhenIssueCreated(t,i);this.issueTypeSelect.model.$element.data("project",this.$project.val())},_handleProjectChangedWhenIssueCreated:function(e,s){e?this.issueTypeSelect.setSelection(e,!1):this.issueTypeSelect.model.setSelected(s,!1)||this.issueTypeSelect.setSelection(this.issueTypeSelect.model.getAllDescriptors()[0],!1)},_handleProjectChangedWhenIssueMoved:function(e,s){this.issueTypeSelect.model.setSelected(s,!1)||this.issueTypeSelect.setSelection(e||this.issueTypeSelect.model.getAllDescriptors()[0],!1)},getIssueTypeSchemeForProject:function(e){return this.projectIssueTypeSchemes[e]},getDefaultIssueTypeForScheme:function(e){return this.issueTypesSchemeDefaults[e]},setIssueTypeScheme:function(e){var s=this.issueTypeSelect.model.getValue();this.issueTypeSelect.model.setFilterGroup(e);this.issueTypeSelect.model.setSelected(s,!1)||this.setDefaultIssueType(e);this.issueTypeSelect.model.$element.data("project",this.$project.val())},setDefaultIssueType:function(e){var s=this.getDefaultIssueTypeForScheme(e),t=this.issueTypeSelect.model.getDescriptor(s);t||(t=this.issueTypeSelect.model.getAllDescriptors()[0]);this.issueTypeSelect.setSelection(t,!1)}})}));AJS.namespace("JIRA.ProjectIssueTypeSelect",null,require("jira/field/project-issue-type-select"));