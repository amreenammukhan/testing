AJS.test.require(["jira.webresources:jira-global"],(function(){"use strict";var i=require("jquery"),e=require("jira/dialog/dialog-register");module("initDialog",{setup:function(){this.server=sinon.fakeServer.create();this.server.respondWith("GET",/.*WorkflowUIDispatcher.*/,[200,{"Content-Type":"text/html"},"-"])},teardown:function(){this.dialog&&this.dialog.hide();this.server.restore()},testTransitionLink:function(t,o,n){i(t).appendTo(i("#qunit-fixture"));i("#"+o).click();this.server.respond();this.dialog=e["workflow-transition-"+n+"-dialog"];ok(this.dialog,"Transition dialog shown");equal(this.dialog.$activeTrigger.attr("id"),"action_id_"+n,"Link is the $activeTrigger of the transition dialog")},testDialogInstancePersistence:function(t,o,n,s,a){var r="workflow-transition-"+n+"-dialog";i(t).appendTo(i("#qunit-fixture"));i("#"+s).click();this.server.respond();var l=e[r];ok(i("#"+r)[0],"Dialog1 appended to DOM");l.hide();ok(!i("#"+r)[0],"Dialog1 removed from DOM");equal(l.options.isIssueDialog,!0);equal(l.options.refreshOnSubmit,!0);i(o).appendTo(i("#qunit-fixture"));i("#"+a).click();this.server.respond();var d=e[r];ok(i("#"+r)[0],"Dialog2 appended to DOM");d.hide();ok(!i("#"+r)[0],"Dialog2 removed from DOM");equal(d.options.isIssueDialog,!1);equal(d.options.refreshOnSubmit,!1);notEqual(l,d)}});var t=function(i,e,t,o){return"<a id='"+i+"' class='issueaction-workflow-transition' href='/secure/WorkflowUIDispatcher.jspa?id="+e+"&action="+e+"' "+o+">"+t+"</a>"};test("Workflow transition link handler called when clicked on a transition link",(function(){var i="action_id_1",e=t(i,"1","Test 1");this.testTransitionLink(e,i,"1")}));test("Workflow transition link handler called when clicked on a span inside transition link",(function(){var i="action_span_id_2",e=t("action_id_2","2","<span id='"+i+"' class='trigger-label'>Test 2</span>");this.testTransitionLink(e,i,"2")}));test("New instance of form dialog created when same link is clicked multiple times",(function(){var i="action_id_1",e=t(i,"2","Issue view dialog"),o="action_id_2",n=t(o,"2","Some other dialog","is-issue-dialog='false' refresh-on-submit='false'");this.testDialogInstancePersistence(e,n,"2",i,o)}))}));